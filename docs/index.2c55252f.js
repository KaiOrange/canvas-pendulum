window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){return window.setTimeout(t,17)}),window.cancelRequestAnimationFrame||(window.cancelRequestAnimationFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.clearTimeout);const t={};t.captureMouse=function(t){var e={x:0,y:0,event:null},i=document.body.scrollLeft,n=document.documentElement.scrollLeft,s=document.body.scrollTop,r=document.documentElement.scrollTop,o=t.offsetLeft,h=t.offsetTop;return t.addEventListener("mousemove",function(t){var a,l;t.pageX||t.pageY?(a=t.pageX,l=t.pageY):(a=t.clientX+i+n,l=t.clientY+s+r),a-=o,l-=h,e.x=a,e.y=l,e.event=t},!1),e},t.parseColor=function(t,e){return!0!==e?("number"==typeof t&&(t="#"+("00000"+(0|t).toString(16)).substr(-6)),t):"number"==typeof t?0|t:("string"==typeof t&&"#"===t[0]&&(t=t.slice(1)),window.parseInt(t,16))},t.colorToRGB=function(t,e){"string"==typeof t&&"#"===t[0]&&(t=window.parseInt(t.slice(1),16));var i=t>>16&255,n=t>>8&255,s=255&t,r=(e=void 0===e?1:e)<0?0:e>1?1:e;return 1===r?"rgb("+i+","+n+","+s+")":"rgba("+i+","+n+","+s+","+r+")"},t.containsPoint=function(t,e,i){return!(e<t.x||e>t.x+t.width||i<t.y||i>t.y+t.height)},t.intersects=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)};var e,i={},n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};e=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var r=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}i=o,i.once=function(t,e){return new Promise(function(i,n){var s;function r(i){t.removeListener(e,o),n(i)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",r),i([].slice.call(arguments))}v(t,e,o,{once:!0}),"error"!==e&&(s={once:!0},"function"==typeof t.on&&v(t,"error",r,s))})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var h=10;function a(t){if("function"!=typeof t)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function u(t,e,i,n){if(a(i),void 0===(r=t._events)?(r=t._events=Object.create(null),t._eventsCount=0):(void 0!==r.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),r=t._events),o=r[e]),void 0===o)o=r[e]=i,++t._eventsCount;else if("function"==typeof o?o=r[e]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),(s=l(t))>0&&o.length>s&&!o.warned){o.warned=!0;var s,r,o,h=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=o.length,console&&console.warn&&console.warn(h)}return t}function c(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},s=c.bind(n);return s.listener=i,n.wrapFn=s,s}function m(t,e,i){var n=t._events;if(void 0===n)return[];var s=n[e];return void 0===s?[]:"function"==typeof s?i?[s.listener||s]:[s]:i?function(t){for(var e=Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(s):f(s,s.length)}function p(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function f(t,e){for(var i=Array(e),n=0;n<e;++n)i[n]=t[n];return i}function v(t,e,i,n){if("function"==typeof t.on)n.once?t.once(e,i):t.on(e,i);else if("function"==typeof t.addEventListener)t.addEventListener(e,function s(r){n.once&&t.removeEventListener(e,s),i(r)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||r(t))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");h=t}}),o.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||r(t))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n="error"===t,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var o,h=Error("Unhandled error."+(o?" ("+o.message+")":""));throw h.context=o,h}var a=r[t];if(void 0===a)return!1;if("function"==typeof a)s(a,this,e);else for(var l=a.length,u=f(a,l),i=0;i<l;++i)s(u[i],this,e);return!0},o.prototype.addListener=function(t,e){return u(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return u(this,t,e,!0)},o.prototype.once=function(t,e){return a(e),this.on(t,d(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return a(e),this.prependListener(t,d(this,t,e)),this},o.prototype.removeListener=function(t,e){var i,n,s,r,o;if(a(e),void 0===(n=this._events)||void 0===(i=n[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(s=-1,r=i.length-1;r>=0;r--)if(i[r]===e||i[r].listener===e){o=i[r].listener,s=r;break}if(s<0)return this;0===s?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,s),1===i.length&&(n[t]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",t,o||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0==arguments.length){var s,r=Object.keys(i);for(n=0;n<r.length;++n)"removeListener"!==(s=r[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},o.prototype.listeners=function(t){return m(this,t,!0)},o.prototype.rawListeners=function(t){return m(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};var y=class{constructor(t={}){if(this.x=t.x||0,this.y=t.y||0,this.radius=t.radius||20,this.vx=t.vx,this.vy=t.vy,this.style=t.style||"red",this.isImageStyle=this.isURL(this.style),this.isImageStyle){let t=new Image;t.src=this.style,t.onload=()=>{this.image=t},t.error=()=>{console.error("[canvas-pendulum] load image error:"+this.style)}}this.rotation=t.rotation||0,this.outLineWidth=t.outLineWidth||1}isURL(t){return"string"==typeof t&&(t.startsWith("http")||t.startsWith(".")||t.startsWith("/"))}draw(t){t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.lineWidth=this.outLineWidth,t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI,!0),t.closePath(),this.isImageStyle?this.image&&(t.save(),t.clip(),t.drawImage(this.image,-this.radius+this.outLineWidth/2,-this.radius+this.outLineWidth/2,2*this.radius-this.outLineWidth,2*this.radius-this.outLineWidth),t.restore()):(t.fillStyle=this.style,t.fill()),this.outLineWidth>0&&t.stroke(),t.restore()}getBounds(){return{x:this.x-this.radius,y:this.y-this.radius,width:2*this.radius,height:2*this.radius}}isPointInBall(t,e){return Math.pow(t-this.x,2)+Math.pow(e-this.y,2)<=Math.pow(this.radius,2)}};class g extends i.EventEmitter{constructor(e={}){if(super(),e=e||{},this.el=e.el,"string"==typeof this.el&&(this.el=document.querySelector(this.el)),this.el){if("CANVAS"===this.el.tagName)this.canvas=this.el;else if(this.el.appendChild)this.canvas=document.createElement("canvas"),this.el.appendChild(this.canvas);else throw Error("参数el错误")}else this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas);this.cWidth=e.width||this.canvas.width||300,this.cHeight=e.height||this.canvas.height||150,this.canvas.width!==this.cWidth&&(this.canvas.width=this.cWidth),this.canvas.height!==this.cHeight&&(this.canvas.height=this.cHeight),this.context=this.canvas.getContext("2d"),this.T=e.T||1e3,this.ballNum=e.ballNum||1,this.ballWidth=e.ballWidth||40,this.maxAngle=e.maxAngle||20,this.outLineWidth=Math.min(e.outLineWidth||1,this.ballWidth),this.initSpeed=2*Math.PI/this.T,this.intX=this.cWidth/2-this.ballNum/2*(this.ballWidth+this.outLineWidth),this.maxRadian=Math.PI*(this.maxAngle||10)/180,this.startTime=+new Date,this.time=this._getTimer();let i=e.lineWidth||(this.cHeight-this.ballWidth)*90/100,n=e.ballStyles||"red";this.pendulums=Array(this.ballNum).fill(0).map((t,e)=>({ball:new y({radius:this.ballWidth/2,style:Array.isArray(n)?n[e]||"red":n,outLineWidth:this.outLineWidth}),radius:this.ballWidth/2,fixedPoint:[this.intX+e*(this.ballWidth+this.outLineWidth)+this.ballWidth/2,0],line:i,spend:0===e?this.initSpeed:0,w:0})),this._status="pause";let s=t.captureMouse(this.canvas);this.canvas.addEventListener("click",t=>{this.pendulums.some((t,e)=>{let i=t.ball.isPointInBall(s.x,s.y);return i&&this.emit("ballClick",{spend:t.spend,index:e,x:s.x,y:s.y}),i})})}_getTimer(){return+new Date-this.startTime}_checkConflict(t,e){return!!t&&!!e&&Math.pow(t.radius+e.radius,2)>Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)}start(){return"running"!==this._status&&(this._status="running",this._run()),this}stop(){return this._status="pause",this}_run(){"running"===this._status&&window.requestAnimationFrame(this._run.bind(this),this.canvas),this.context.clearRect(0,0,this.canvas.width,this.canvas.height);let t=this._getTimer()-this.time;if(this.time=this._getTimer(),this.pendulums.forEach(e=>{e.w+=e.spend*t;let i=Math.sin(e.w)*this.maxRadian;e.ball.x=e.fixedPoint[0]-(e.line+e.radius)*Math.sin(i),e.ball.y=e.fixedPoint[1]+(e.line+e.radius)*Math.cos(i),this.context.save(),this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(e.fixedPoint[0]||9,e.fixedPoint[1]||0),this.context.lineTo(e.fixedPoint[0]-e.line*Math.sin(i),e.fixedPoint[1]+e.line*Math.cos(i)),this.context.stroke(),this.context.restore(),0!==i&&(e.ball.rotation=i),e.ball.draw(this.context)}),this.pendulums.length>=2&&(this._checkConflict(this.pendulums[0].ball,this.pendulums[1].ball)||this._checkConflict(this.pendulums[this.pendulums.length-1].ball,this.pendulums[this.pendulums.length-2].ball))){this.emit("ping",{isFrist:this.pendulums[0].spend>0});let t=this.pendulums[0].spend,e=this.pendulums[0].w;this.pendulums[0].spend=this.pendulums[this.pendulums.length-1].spend,this.pendulums[0].w=this.pendulums[this.pendulums.length-1].w,this.pendulums[this.pendulums.length-1].spend=t,this.pendulums[this.pendulums.length-1].w=e}}}window.onload=function(){let t=new g({el:document.getElementById("canvas"),ballNum:4,ballStyles:["https://www.kai666666.com/images/avatar.png","#00ff00","orange","transparent"]});t.start(),t.on("ping",t=>{console.log("碰撞了")}),t.on("ballClick",t=>{console.log("小球被点击")})};
//# sourceMappingURL=index.2c55252f.js.map
